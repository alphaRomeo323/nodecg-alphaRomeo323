<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>frame</title>
        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link
            href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500&display=swap"
            rel="stylesheet"
        />
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
        <link href="frame.css" rel="stylesheet" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="common.js"></script>
    </head>
    <body class="m-0 w-screen h-screen overflow-hidden text-[32px]">
        <div class="greenback"></div>
        <div id="title-box"class="textbox title">
            <span id="title" class="font-jp"></span>
        </div>
        <div id="right-box-upper" class="textbox right-box upper">
            <div id="vc" class="text-[24px] font-jp absolute overflow-hidden top-2 left-2">
            </div>
        </div>
        <div id="right-box-lower" class="textbox right-box lower"></div>
        <div id="down-box" class="textbox bottom-box">
            <div class="bottom-box-text">
                <span id="memo" class="font-jp"></span>
            </div>
        </div>
        <div class="bottom-line info">
            <div id="animation-text" class="font-jp scroll"></div>
        </div>
        <div class="bg-white px-4 rounded-full align-middle overflow-hidden shadow-2xl bottom-line clock">
            <span class="material-icons">schedule</span>
            <span id="clock" class="font-jp"></span>
        </div>
        <div class="logo">
            <img id="logo">
        </div>
        <div id="vc-template" class="align-middle hidden text-left">
            <img class="rounded-full inline shadow-2xl"
                src="https://cdn.discordapp.com/icons/442549986207596544/a_4d26de7c9984ef733532a153e499cebf.gif?size=4096"
                width="40" height="40" />
            <span class="inline">Test</span>
            
        </div>
        
            
    </body>
    <script>
        setInterval(() => {
            clock(document.getElementById("clock"));
        }, 1000);
        const titleElm = document.getElementById("title-box");
        const downBoxElm = document.getElementById("down-box");
        nodecg.Replicant("title").on("change", (newValue) => {
            if ( newValue != undefined){
            document.getElementById("title").innerText = newValue
                titleElm.style.fontSize = '56px';
                for(
                    size = 56;
                    titleElm.getBoundingClientRect().height < titleElm.scrollHeight && size > 12;
                    size--
                ) {
                    titleElm.style.fontSize = size + 'px';
                }
            }
        });
        nodecg.Replicant("memo").on("change", (newValue) => {
            if ( newValue != undefined){
            document.getElementById("memo").innerText = newValue
                titleElm.style.fontSize = '40px';
                for(
                    size = 56;
                    titleElm.getBoundingClientRect().height < titleElm.scrollHeight && size > 12;
                    size--
                ) {
                    titleElm.style.fontSize = size + 'px';
                }
            }
        });
        /*
        nodecg.Replicant("info").on("change", (newValue) => {
            document.getElementById("animation-text").innerText = nodecg.Replicant("info").value;
        });
        */
        nodecg.Replicant("logo").on("change", (newValue) => {
            if(newValue != undefined){
                document.getElementById("logo").src = newValue;
            }
        });
        nodecg.Replicant("vc", 'nodecg-discord-utils').on("change", (newValue) => {
            const vcElem = document.getElementById("vc");
            let child = vcElem.lastElementChild;
            while (child) {
                vcElem.removeChild(child);
                child = vcElem.lastElementChild;
            }
            newValue.forEach((value) => {
                let tmpElem = document.getElementById("vc-template").cloneNode(true);
                tmpElem.classList.remove("hidden")
                tmpElem.id = "";
                tmpElem.firstElementChild.src = value.avatar;
                tmpElem.lastElementChild.innerText = value.name;
                vcElem.appendChild(tmpElem);
            })
        });
        

    </script>
</html>
