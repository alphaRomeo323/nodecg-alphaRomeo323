<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
        <title>Mopidy</title>
        <style>
            button {
            font-size: large;
            width: 4rem;
            }
        </style>
    </head>
    <body>
        <section>
            <label>
                Channel Id: <input type="text" id="mopidy-server" name="mopidy-server" size="20">
            </label>
        </section>
        <section>
            <button id="update">Start</button>
            <span id="log"></span>
        </section>
    </body>
    <script>
        const activeRep = nodecg.Replicant("mopidy-active");
        const mopidyServerRep = nodecg.Replicant("mopidy-server");
        const logRep = nodecg.Replicant("mopidy-connection-log");
        const updateBtn = document.getElementById("update");
        const mopidyServerElm = document.getElementById("mopidy-server");
        const logElm = document.getElementById("log")

        NodeCG.waitForReplicants(activeRep, mopidyServerRep, logRep).then(() => {

            updateBtn.onclick = () => {
                mopidyServerRep.value = mopidyServerElm.value;
                activeRep.value = true
                updateBtn.disabled = true;
                setTimeout(() => {
                    activeRep.value = false;
                    updateBtn.disabled = false;
                }, 1000)
                }

            mopidyServerRep.on("change", (newValue) => {
                mopidyServerElm.value = mopidyServerRep.value;
            })

            logRep.on("change", (newValue) => {
                logElm.innerText = newValue;
            })
        })
    </script>
</html>